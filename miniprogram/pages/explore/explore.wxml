<!--pages/explore/explore.wxml-->
<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-bar" bindtap="onSearch">
    <text class="search-icon">ğŸ”</text>
    <text class="search-placeholder">æœç´¢æ´»åŠ¨æˆ–ç”¨æˆ·</text>
  </view>

  <!-- ç­›é€‰æ  -->
  <view class="filter-bar">
    <!-- åˆ†ç±»ç­›é€‰ -->
    <view class="filter-group">
      <view
        class="filter-item {{category === '' ? 'active' : ''}}"
        data-category=""
        bindtap="onCategoryChange"
      >
        å…¨éƒ¨
      </view>
      <view
        class="filter-item {{category === 'clothing' ? 'active' : ''}}"
        data-category="clothing"
        bindtap="onCategoryChange"
      >
        æœè£…
      </view>
      <view
        class="filter-item {{category === 'books' ? 'active' : ''}}"
        data-category="books"
        bindtap="onCategoryChange"
      >
        ä¹¦ç±
      </view>
      <view
        class="filter-item {{category === 'cosmetics' ? 'active' : ''}}"
        data-category="cosmetics"
        bindtap="onCategoryChange"
      >
        ç¾å¦†
      </view>
      <view
        class="filter-item {{category === 'other' ? 'active' : ''}}"
        data-category="other"
        bindtap="onCategoryChange"
      >
        å…¶ä»–
      </view>
    </view>

    <!-- æ’åºå’ŒçŠ¶æ€ -->
    <view class="filter-actions">
      <view
        class="filter-btn {{sort === 'latest' ? 'active' : ''}}"
        data-sort="latest"
        bindtap="onSortChange"
      >
        æœ€æ–°
      </view>
      <view
        class="filter-btn {{sort === 'popular' ? 'active' : ''}}"
        data-sort="popular"
        bindtap="onSortChange"
      >
        æœ€çƒ­
      </view>
      <view
        class="filter-btn {{status === 'active' ? 'active' : ''}}"
        data-status="active"
        bindtap="onStatusChange"
      >
        è¿›è¡Œä¸­
      </view>
    </view>
  </view>

  <!-- æ´»åŠ¨åˆ—è¡¨ -->
  <view class="activities-list" wx:if="{{!loading && activities.length > 0}}">
    <view
      class="activity-card"
      wx:for="{{activities}}"
      wx:key="activity_id"
      data-id="{{item.activity_id}}"
      data-link-id="{{item.shareable_link}}"
      bindtap="onActivityTap"
    >
      <!-- æ´»åŠ¨å°é¢å›¾ï¼ˆç¬¬ä¸€å¼ ç‰©å“å›¾ç‰‡ï¼‰ -->
      <view class="activity-cover" wx:if="{{item.items && item.items.length > 0}}">
        <image
          class="cover-image"
          src="{{item.items[0].photo_urls[0]}}"
          mode="aspectFill"
          lazy-load="{{true}}"
        ></image>
        <view class="cover-overlay">
          <text class="items-count">{{item.items.length}}ä»¶ç‰©å“</text>
        </view>
      </view>

      <!-- æ´»åŠ¨ä¿¡æ¯ -->
      <view class="activity-info">
        <view class="activity-header">
          <view class="user-info">
            <image
              class="user-avatar"
              src="{{item.influencer.avatar_url || '/images/default-avatar.png'}}"
              mode="aspectFill"
            ></image>
            <text class="user-nickname">{{item.influencer.nickname || 'ç”¨æˆ·'}}</text>
          </view>
          <text class="activity-status">è¿›è¡Œä¸­</text>
        </view>

        <view class="activity-items">
          <view
            class="item-preview"
            wx:for="{{item.items}}"
            wx:for-item="item"
            wx:key="item_id"
            wx:for-index="itemIndex"
            wx:if="{{itemIndex < 3}}"
          >
            <text class="item-name">{{item.label || 'æœªå‘½åç‰©å“'}}</text>
            <text class="item-shipping">Â¥{{item.shipping_cost_estimate}}</text>
          </view>
        </view>

        <view class="activity-footer">
          <text class="activity-time">{{item.created_at}}</text>
          <text class="view-detail">æŸ¥çœ‹è¯¦æƒ… â†’</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading" wx:if="{{loading && activities.length === 0}}">
    <loading loading="{{true}}" message="åŠ è½½ä¸­..."></loading>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:if="{{!loading && activities.length === 0}}">
    <text class="empty-text">æš‚æ— æ´»åŠ¨</text>
    <text class="empty-desc">è¯•è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶</text>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="loading-more" wx:if="{{loading && activities.length > 0}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <view class="no-more" wx:if="{{!hasMore && activities.length > 0}}">
    <text>æ²¡æœ‰æ›´å¤šäº†</text>
  </view>
</view>


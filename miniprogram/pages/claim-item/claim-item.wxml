<!--pages/claim-item/claim-item.wxml-->
<view class="container">
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <view wx:else class="content">
    <!-- Item Info -->
    <view class="item-section">
      <image class="item-image" src="{{item.photo_urls[0]}}" mode="aspectFill" />
      <view class="item-info">
        <text class="item-label">{{item.label || 'æœªå‘½åç‰©å“'}}</text>
        <text class="item-category">{{item.category}}</text>
        <text class="item-stock">å‰©ä½™{{item.remaining_quantity}}ä»¶</text>
        <text class="shipping-cost">å•ä»¶åŸºç¡€è¿è´¹: Â¥{{item.base_shipping_cost}}</text>
      </view>
    </view>

    <!-- æ•°é‡é€‰æ‹©å™¨ -->
    <view class="quantity-section">
      <view class="section-title">é€‰æ‹©æ•°é‡</view>
      <view class="quantity-selector">
        <button class="quantity-btn" bindtap="onDecreaseQuantity" disabled="{{quantity <= 1}}">
          -
        </button>
        <text class="quantity-value">{{quantity}}</text>
        <button class="quantity-btn" bindtap="onIncreaseQuantity" disabled="{{quantity >= maxQuantity}}">
          +
        </button>
        <text class="quantity-hint">ï¼ˆæœ€å¤š{{maxQuantity}}ä»¶ï¼‰</text>
      </view>
    </view>

    <!-- è´¹ç”¨æ˜ç»† -->
    <view class="cost-section">
      <view class="section-title">è´¹ç”¨æ˜ç»†</view>
      <view class="cost-item">
        <text class="cost-label">åŸºç¡€è¿è´¹</text>
        <text class="cost-value">Â¥{{baseShippingCost}}</text>
      </view>
      <view class="cost-item">
        <text class="cost-label">åŒ…è£…è´¹ï¼ˆÂ¥2 Ã— {{quantity}}ï¼‰</text>
        <text class="cost-value">Â¥{{packagingFee}}</text>
      </view>
      <view class="cost-item">
        <text class="cost-label">å¹³å°æœåŠ¡è´¹ï¼ˆ10%ï¼‰</text>
        <text class="cost-value">Â¥{{platformFee}}</text>
      </view>
      <view class="cost-divider"></view>
      <view class="cost-item cost-total">
        <text class="cost-label">åˆè®¡</text>
        <text class="cost-value total">Â¥{{totalAmount}}</text>
      </view>
    </view>

    <!-- Shipping Form -->
    <view class="form-section">
      <view class="section-header">
        <view class="section-title">æ”¶è´§ä¿¡æ¯</view>
        <button class="load-address-btn" bindtap="onLoadUserAddress" wx:if="{{!addressLoaded}}">
          ğŸ“¦ è¯»å–æˆ‘çš„åœ°å€
        </button>
        <text class="address-loaded-hint" wx:else>âœ… å·²åŠ è½½</text>
      </view>

      <view class="form-item">
        <text class="label">æ”¶è´§åœ°å€</text>
        <picker mode="region" bindchange="onRegionChange">
          <view class="picker">
            {{shippingAddress.province && shippingAddress.city && shippingAddress.district
              ? shippingAddress.province + ' ' + shippingAddress.city + ' ' + shippingAddress.district
              : 'è¯·é€‰æ‹©çœå¸‚åŒº'}}
          </view>
        </picker>
      </view>

      <view class="form-item">
        <text class="label">è¯¦ç»†åœ°å€</text>
        <input
          class="input"
          placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€"
          value="{{shippingAddress.street}}"
          bindinput="onStreetInput"
        />
      </view>

      <view class="form-item">
        <text class="label">é‚®æ”¿ç¼–ç ï¼ˆé€‰å¡«ï¼‰</text>
        <input
          class="input"
          type="number"
          placeholder="è¯·è¾“å…¥é‚®æ”¿ç¼–ç "
          value="{{shippingAddress.postal_code}}"
          bindinput="onPostalCodeInput"
          maxlength="6"
        />
      </view>

      <view class="form-item">
        <text class="label">è”ç³»äººå§“å</text>
        <input
          class="input"
          placeholder="è¯·è¾“å…¥è”ç³»äººå§“å"
          value="{{shippingContactName}}"
          bindinput="onContactNameInput"
        />
      </view>

      <view class="form-item">
        <text class="label">è”ç³»äººæ‰‹æœºå·</text>
        <input
          class="input"
          type="number"
          placeholder="è¯·è¾“å…¥è”ç³»äººæ‰‹æœºå·"
          value="{{shippingContactPhone}}"
          bindinput="onContactPhoneInput"
          maxlength="11"
        />
      </view>
    </view>

    <!-- Submit Button -->
    <view class="submit-section">
      <button class="submit-btn" bindtap="onSubmit" disabled="{{submitting}}">
        {{submitting ? 'å¤„ç†ä¸­...' : 'ç¡®è®¤é¢†å–å¹¶æ”¯ä»˜'}}
      </button>
    </view>
  </view>
</view>


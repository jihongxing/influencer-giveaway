# 创建活动流程详细设计

## 流程概述

所有用户都可以发起赠送活动，流程分为4个步骤：

```
步骤1: 拍照上传
  ↓
步骤2: AI识别处理（自动）
  ↓
步骤3: 编辑物品信息（支持批量操作）
  ↓
步骤4: 预览和发布
```

## 步骤1：拍照上传

### 功能
- 支持拍照或从相册选择
- 支持批量选择（最多20张）
- 图片预览
- 图片删除
- 自动压缩

### 界面设计
```
┌─────────────────────────────┐
│  上传照片                    │
│  ────────────────────────   │
│                             │
│  ┌─────┐ ┌─────┐ ┌─────┐  │
│  │图片1│ │图片2│ │ +   │  │
│  └─────┘ └─────┘ └─────┘  │
│                             │
│  ┌─────┐ ┌─────┐ ┌─────┐  │
│  │图片3│ │图片4│ │图片5│  │
│  └─────┘ └─────┘ └─────┘  │
│                             │
│  提示：最多上传20张照片      │
│                             │
│  [下一步：AI识别]            │
└─────────────────────────────┘
```

### 交互
- 点击"+"选择照片
- 长按图片显示删除按钮
- 显示上传进度
- 上传完成后显示缩略图

---

## 步骤2：AI识别处理（自动）

### 功能
- 自动识别物品类型
- 自动计算运费
- 显示处理进度
- 处理完成后自动进入下一步

### 界面设计
```
┌─────────────────────────────┐
│  AI识别中...                 │
│  ────────────────────────   │
│                             │
│        [加载动画]            │
│                             │
│  正在识别物品类型...         │
│  进度: 3/10                  │
│                             │
│  请稍候，这可能需要几分钟    │
│                             │
└─────────────────────────────┘
```

### 交互
- 显示处理进度
- 显示当前处理的物品
- 处理完成后自动跳转

---

## 步骤3：编辑物品信息（核心步骤）

### 功能
- 编辑单个物品信息
- **批量设置数量**（重要功能）
- 批量设置分类
- 批量设置运费
- 批量删除
- 添加更多照片

### 界面设计

#### 批量操作栏
```
┌─────────────────────────────┐
│  批量操作                    │
│  [批量设置数量] [批量设置分类] │
│  [批量设置运费] [批量删除]   │
└─────────────────────────────┘
```

#### 物品列表
```
┌─────────────────────────────┐
│  [图片]                      │
│  ────────────────────────   │
│  物品名称: [输入框]          │
│  分类: [下拉选择]            │
│  数量: [数字输入] ⭐         │
│  运费: ¥XX [可调整]          │
│  描述: [文本输入]             │
│  标记名称: [输入框]          │
│  [删除]                      │
└─────────────────────────────┘
```

### 批量操作详细设计

#### 1. 批量设置数量
**触发**：点击"批量设置数量"按钮

**流程**：
1. 弹出对话框
2. 输入统一数量（数字输入框）
3. 选择应用范围：
   - 应用到所有物品
   - 应用到选中物品（需先选择）
4. 确认应用

**界面**：
```
┌─────────────────────────────┐
│  批量设置数量                │
│  ────────────────────────   │
│                             │
│  统一数量: [____]           │
│                             │
│  应用范围:                   │
│  ○ 所有物品                  │
│  ○ 选中物品 (3个)            │
│                             │
│  [取消] [确认]               │
└─────────────────────────────┘
```

#### 2. 批量设置分类
**触发**：点击"批量设置分类"按钮

**流程**：
1. 弹出分类选择器
2. 选择分类
3. 选择应用范围
4. 确认应用

#### 3. 批量设置运费
**触发**：点击"批量设置运费"按钮

**流程**：
1. 弹出输入框
2. 输入统一运费
3. 选择应用范围
4. 确认应用

#### 4. 批量删除
**触发**：点击"批量删除"按钮

**流程**：
1. 进入选择模式
2. 选择要删除的物品
3. 确认删除

### 单个物品编辑

**可编辑字段**：
- 物品名称/标签（文本输入）
- 分类（下拉选择，可修改AI识别的分类）
- **数量**（数字输入，重要：支持1-999）
- 运费（数字输入，可调整）
- 描述（多行文本输入，可选）
- 标记名称（文本输入，用于订单匹配，可选）

**操作**：
- 保存修改
- 删除物品
- 添加更多照片（可选）

---

## 步骤4：预览和发布

### 功能
- 活动预览
- 设置活动标记名称（可选）
- 确认发布
- 生成分享链接和二维码

### 界面设计
```
┌─────────────────────────────┐
│  活动预览                    │
│  ────────────────────────   │
│                             │
│  物品总数: 10                │
│  总运费: ¥XXX               │
│                             │
│  [物品列表预览]              │
│                             │
│  活动标记名称: [输入框]      │
│  (可选，用于批量标记)        │
│                             │
│  [返回编辑] [确认发布]       │
└─────────────────────────────┘
```

### 发布后界面
```
┌─────────────────────────────┐
│  发布成功！                  │
│  ────────────────────────   │
│                             │
│  分享链接:                   │
│  [链接] [复制]               │
│                             │
│  [二维码]                    │
│                             │
│  [查看活动] [继续创建]       │
└─────────────────────────────┘
```

---

## 技术实现要点

### 1. 图片上传
- 使用 `wx.chooseImage` 选择照片
- 使用 `wx.uploadFile` 上传
- 压缩图片（使用已有工具）

### 2. AI识别
- 调用后端API `/items/process`
- 显示处理进度
- 处理完成后获取结果

### 3. 批量操作
- 使用选择模式（多选）
- 批量更新数据
- 实时更新UI

### 4. 数量管理
- 每个物品独立数量字段
- 支持批量设置
- 验证数量范围（1-999）

### 5. 数据保存
- 步骤3可以保存草稿
- 步骤4确认发布
- 发布后生成分享链接

---

## 数据模型

### 物品数据结构
```javascript
{
  temp_id: string,           // 临时ID
  photo_urls: string[],      // 图片URL数组
  ai_category: string,       // AI识别的分类
  manual_category: string,   // 手动分类（可选）
  label: string,             // 物品名称/标签
  description: string,      // 描述（可选）
  quantity: number,          // 数量 ⭐重要
  shipping_cost_estimate: number, // 运费估算
  marker_name: string,       // 标记名称（可选）
}
```

### 活动数据结构
```javascript
{
  items: Item[],             // 物品列表
  marker_name: string,       // 活动标记名称（可选）
  status: 'draft' | 'active' // 状态
}
```

---

## 用户体验优化

### 1. 进度提示
- 每个步骤显示进度
- 处理中显示加载动画
- 错误时显示友好提示

### 2. 数据保存
- 自动保存草稿
- 支持继续编辑
- 防止数据丢失

### 3. 操作便捷
- 支持批量操作
- 支持快速编辑
- 支持撤销操作

### 4. 验证提示
- 数量验证（1-999）
- 运费验证（>0）
- 必填项验证


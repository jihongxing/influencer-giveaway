# 云开发迁移检查清单

## 已完成 ✅

- [x] 开通并配置微信云开发环境（环境ID: cloud1-8gezjcq432191d0d）
- [x] 初始化云开发SDK到小程序（修改app.js）
- [x] 配置project.config.json添加云函数目录
- [x] 创建auth云函数（用户注册、登录、获取手机号）
- [x] 创建activities云函数（活动创建、查询、公开列表）
- [x] 创建云函数API服务层（api-cloud.js）

## 待完成 ⬜

### 数据库设置
- [ ] 在云开发控制台创建数据库集合：
  - [ ] `users` - 用户信息
  - [ ] `activities` - 活动信息
  - [ ] `items` - 物品信息
  - [ ] `orders` - 订单信息
  - [ ] `shipping` - 物流信息
  - [ ] `sharing_posts` - 分享帖子
  - [ ] `external_activities` - 外部活动

### 云函数环境变量
- [ ] 在云开发控制台配置环境变量：
  - [ ] `WECHAT_SECRET` - 微信 AppSecret
  - [ ] `WECHAT_MCHID` - 微信支付商户号（可选）
  - [ ] `WECHAT_API_KEY` - 微信支付 API Key（可选）

### 云函数部署
- [ ] 部署auth云函数
- [ ] 部署activities云函数
- [ ] 创建并部署items云函数
- [ ] 创建并部署orders云函数
- [ ] 创建并部署payments云函数
- [ ] 创建并部署sharing云函数

### 前端代码修改
- [ ] 修改所有页面使用api-cloud.js替代api.js
- [ ] 修改文件上传逻辑使用云存储
- [ ] 测试所有功能是否正常

### 测试验证
- [ ] 测试用户注册功能
- [ ] 测试用户登录功能
- [ ] 测试活动创建功能
- [ ] 测试活动列表查询
- [ ] 测试公开活动页面
- [ ] 测试订单创建和查询
- [ ] 测试支付功能
- [ ] 测试文件上传功能

## 迁移步骤说明

### 1. 创建数据库集合

在微信开发者工具的云开发控制台中：
1. 进入"数据库"
2. 点击"添加集合"
3. 逐个创建上述集合

### 2. 配置环境变量

在云开发控制台：
1. 进入"云函数" → "环境变量"
2. 添加所需的环境变量

### 3. 部署云函数

在微信开发者工具中：
1. 右键点击 `cloudfunctions/auth` 目录
2. 选择"上传并部署：云端安装依赖"
3. 等待部署完成
4. 重复上述步骤部署其他云函数

### 4. 修改前端代码

将所有页面中的：
```javascript
const apiService = require('../../services/api').default;
```

替换为：
```javascript
const apiService = require('../../services/api-cloud').default;
```

### 5. 测试功能

在微信开发者工具中测试各个功能是否正常工作。

## 注意事项

1. **数据库权限**：确保数据库集合的权限设置正确
2. **云函数权限**：确保云函数有访问数据库和云存储的权限
3. **环境变量**：敏感信息（如AppSecret）必须通过环境变量配置
4. **错误处理**：云函数调用失败时要有适当的错误提示
5. **数据迁移**：如果有现有数据，需要编写迁移脚本

## 回滚方案

如果迁移出现问题，可以：
1. 保留原有的api.js服务
2. 通过配置切换使用哪个API服务
3. 逐步迁移，先迁移部分功能测试

